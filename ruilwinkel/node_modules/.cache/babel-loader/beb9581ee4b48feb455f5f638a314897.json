{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs3/core-js-stable/object/define-property\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = void 0;\n\nvar _indexOf = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/index-of\"));\n\nvar _filter = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\"));\n\nvar _concat = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs3/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/createClass\"));\n\nvar _ParseUser = _interopRequireDefault(require(\"./ParseUser\"));\n\nvar _ParseQuery = _interopRequireDefault(require(\"./ParseQuery\"));\n\nvar _ParseObject = _interopRequireDefault(require(\"./ParseObject\"));\n\nvar _ParseACL = _interopRequireDefault(require(\"./ParseACL\"));\n\nvar INIT_ERROR = 'Could not initialise ledger app, make sure Elrond app is open';\n\nfunction getErdJs() {\n  return MoralisErd.getErdJs();\n}\n\nvar MoralisErd = /*#__PURE__*/function () {\n  function MoralisErd() {\n    (0, _classCallCheck2.default)(this, MoralisErd);\n  }\n\n  (0, _createClass2.default)(MoralisErd, null, [{\n    key: \"getErdJs\",\n    value: function () {\n      if (typeof window !== 'undefined' && window.erdjs) return window.erdjs;\n      throw new Error('Please add erdjs scripts');\n    }\n  }, {\n    key: \"gatewayAddress\",\n    value: function () {\n      return 'https://gateway.elrond.com';\n    }\n  }, {\n    key: \"hwProxy\",\n    value: function () {\n      var _hwProxy = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {\n        var _getErdJs, ProxyProvider, proxy;\n\n        return _regenerator.default.wrap(function (_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!MoralisErd._proxy) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", MoralisErd._proxy);\n\n              case 2:\n                _getErdJs = getErdJs(), ProxyProvider = _getErdJs.ProxyProvider;\n                proxy = new ProxyProvider(MoralisErd.gatewayAddress());\n                MoralisErd._proxy = proxy;\n                return _context.abrupt(\"return\", MoralisErd._proxy);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function () {\n        return _hwProxy.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"hwProvider\",\n    value: function () {\n      return MoralisErd._hw;\n    }\n  }, {\n    key: \"enable\",\n    value: function () {\n      var _enable = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2() {\n        var _getErdJs2, HWProvider, proxy, hw, success;\n\n        return _regenerator.default.wrap(function (_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _getErdJs2 = getErdJs(), HWProvider = _getErdJs2.HWProvider;\n                _context2.next = 3;\n                return MoralisErd.hwProxy();\n\n              case 3:\n                proxy = _context2.sent;\n                hw = new HWProvider(proxy);\n                _context2.next = 7;\n                return hw.init();\n\n              case 7:\n                success = _context2.sent;\n\n                if (success) {\n                  _context2.next = 10;\n                  break;\n                }\n\n                throw new Error(INIT_ERROR);\n\n              case 10:\n                MoralisErd._hw = hw;\n                return _context2.abrupt(\"return\", hw);\n\n              case 12:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function () {\n        return _enable.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"authenticate\",\n    value: function () {\n      var _authenticate = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {\n        var _context3, _user$get;\n\n        var hw, address, erdAddress, accounts, data, signature, authData, user;\n        return _regenerator.default.wrap(function (_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return MoralisErd.enable();\n\n              case 2:\n                hw = _context4.sent;\n                _context4.next = 5;\n                return hw.login();\n\n              case 5:\n                address = _context4.sent; // const account = await proxy.getAccount(address);\n\n                erdAddress = address.toLowerCase();\n                accounts = [erdAddress];\n                data = MoralisErd.getSigningData();\n                _context4.next = 11;\n                return MoralisErd.sign(data);\n\n              case 11:\n                signature = _context4.sent;\n                authData = {\n                  id: erdAddress,\n                  signature: signature,\n                  data: data\n                };\n                console.log(authData);\n                _context4.next = 16;\n                return _ParseUser.default.logInWith('moralisErd', {\n                  authData: authData\n                });\n\n              case 16:\n                user = _context4.sent;\n                _context4.next = 19;\n                return user.setACL(new _ParseACL.default(user));\n\n              case 19:\n                if (user) {\n                  _context4.next = 21;\n                  break;\n                }\n\n                throw new Error('Could not get user');\n\n              case 21:\n                user.set('erdAccounts', uniq((0, _concat.default)(_context3 = []).call(_context3, accounts, (_user$get = user.get('erdAccounts')) !== null && _user$get !== void 0 ? _user$get : [])));\n                user.set('erdAddress', erdAddress);\n                _context4.next = 25;\n                return user.save();\n\n              case 25:\n                return _context4.abrupt(\"return\", user);\n\n              case 26:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function () {\n        return _authenticate.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"link\",\n    value: function () {\n      var _link = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4(account) {\n        var _context5, _user$get2;\n\n        var user, erdAddress, ErdAddress, query, erdAddressRecord, data, signature, authData;\n        return _regenerator.default.wrap(function (_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return _ParseUser.default.current();\n\n              case 2:\n                user = _context6.sent;\n                erdAddress = account.toLowerCase();\n                ErdAddress = _ParseObject.default.extend('_ErdAddress');\n                query = new _ParseQuery.default(ErdAddress);\n                _context6.next = 8;\n                return query.get(erdAddress).catch(function () {\n                  return null;\n                });\n\n              case 8:\n                erdAddressRecord = _context6.sent;\n\n                if (erdAddressRecord) {\n                  _context6.next = 17;\n                  break;\n                }\n\n                data = MoralisErd.getSigningData();\n                _context6.next = 13;\n                return MoralisErd.sign(data);\n\n              case 13:\n                signature = _context6.sent;\n                authData = {\n                  id: erdAddress,\n                  signature: signature,\n                  data: data\n                };\n                _context6.next = 17;\n                return user.linkWith('moralisErd', {\n                  authData: authData\n                });\n\n              case 17:\n                user.set('erdAccounts', uniq((0, _concat.default)(_context5 = [erdAddress]).call(_context5, (_user$get2 = user.get('erdAccounts')) !== null && _user$get2 !== void 0 ? _user$get2 : [])));\n                user.set('erdAddress', erdAddress);\n                _context6.next = 21;\n                return user.save();\n\n              case 21:\n                return _context6.abrupt(\"return\", user);\n\n              case 22:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      return function () {\n        return _link.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"unlink\",\n    value: function () {\n      var _unlink = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5(account) {\n        var _user$get3;\n\n        var accountsLower, ErdAddress, query, erdAddressRecord, user, accounts, nextAccounts;\n        return _regenerator.default.wrap(function (_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                accountsLower = account.toLowerCase();\n                ErdAddress = _ParseObject.default.extend('_EthAddress');\n                query = new _ParseQuery.default(ErdAddress);\n                _context7.next = 5;\n                return query.get(accountsLower);\n\n              case 5:\n                erdAddressRecord = _context7.sent;\n                _context7.next = 8;\n                return erdAddressRecord.destroy();\n\n              case 8:\n                _context7.next = 10;\n                return _ParseUser.default.current();\n\n              case 10:\n                user = _context7.sent;\n                accounts = (_user$get3 = user.get('erdAccounts')) !== null && _user$get3 !== void 0 ? _user$get3 : [];\n                nextAccounts = (0, _filter.default)(accounts).call(accounts, function (v) {\n                  return v !== accountsLower;\n                });\n                user.set('erdAccounts', nextAccounts);\n                user.set('erdAddress', nextAccounts[0]);\n                _context7.next = 17;\n                return user._unlinkFrom('moralisErd');\n\n              case 17:\n                _context7.next = 19;\n                return user.save();\n\n              case 19:\n                return _context7.abrupt(\"return\", user);\n\n              case 20:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      return function () {\n        return _unlink.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"sign\",\n    value: function () {\n      var _sign = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6(data) {\n        return _regenerator.default.wrap(function (_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                return _context8.abrupt(\"return\", data);\n\n              case 1:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee6);\n      }));\n\n      return function () {\n        return _sign.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"getSigningData\",\n    value: function () {\n      return 'Moralis Authentication';\n    }\n  }]);\n  return MoralisErd;\n}();\n\nfunction uniq(arr) {\n  return (0, _filter.default)(arr).call(arr, function (v, i) {\n    return (0, _indexOf.default)(arr).call(arr, v) === i;\n  });\n}\n\nvar _default = MoralisErd;\nexports.default = _default;","map":{"version":3,"sources":["C:/Users/Stygal/Documents/Zuyd/blok 4/Casusblok-4-jaar-2-groep-F4/ruilwinkel/node_modules/moralis/lib/browser/MoralisErd.js"],"names":["_interopRequireDefault","require","_Object$defineProperty","exports","value","default","_indexOf","_filter","_concat","_regenerator","_asyncToGenerator2","_classCallCheck2","_createClass2","_ParseUser","_ParseQuery","_ParseObject","_ParseACL","INIT_ERROR","getErdJs","MoralisErd","key","window","erdjs","Error","_hwProxy","mark","_callee","_getErdJs","ProxyProvider","proxy","wrap","_context","prev","next","_proxy","abrupt","gatewayAddress","stop","apply","arguments","_hw","_enable","_callee2","_getErdJs2","HWProvider","hw","success","_context2","hwProxy","sent","init","_authenticate","_callee3","_context3","_user$get","address","erdAddress","accounts","data","signature","authData","user","_context4","enable","login","toLowerCase","getSigningData","sign","id","console","log","logInWith","setACL","set","uniq","call","get","save","_link","_callee4","account","_context5","_user$get2","ErdAddress","query","erdAddressRecord","_context6","current","extend","catch","linkWith","_unlink","_callee5","_user$get3","accountsLower","nextAccounts","_context7","destroy","v","_unlinkFrom","_sign","_callee6","_context8","arr","i","_default"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\r\n\r\nvar _Object$defineProperty = require(\"@babel/runtime-corejs3/core-js-stable/object/define-property\");\r\n\r\n_Object$defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\n\r\nexports.default = void 0;\r\n\r\nvar _indexOf = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/index-of\"));\r\n\r\nvar _filter = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\"));\r\n\r\nvar _concat = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\"));\r\n\r\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs3/regenerator\"));\r\n\r\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/asyncToGenerator\"));\r\n\r\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/classCallCheck\"));\r\n\r\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/createClass\"));\r\n\r\nvar _ParseUser = _interopRequireDefault(require(\"./ParseUser\"));\r\n\r\nvar _ParseQuery = _interopRequireDefault(require(\"./ParseQuery\"));\r\n\r\nvar _ParseObject = _interopRequireDefault(require(\"./ParseObject\"));\r\n\r\nvar _ParseACL = _interopRequireDefault(require(\"./ParseACL\"));\r\n\r\nvar INIT_ERROR = 'Could not initialise ledger app, make sure Elrond app is open';\r\n\r\nfunction getErdJs() {\r\n  return MoralisErd.getErdJs();\r\n}\r\n\r\nvar MoralisErd = /*#__PURE__*/function () {\r\n  function MoralisErd() {\r\n    (0, _classCallCheck2.default)(this, MoralisErd);\r\n  }\r\n\r\n  (0, _createClass2.default)(MoralisErd, null, [{\r\n    key: \"getErdJs\",\r\n    value: function () {\r\n      if (typeof window !== 'undefined' && window.erdjs) return window.erdjs;\r\n      throw new Error('Please add erdjs scripts');\r\n    }\r\n  }, {\r\n    key: \"gatewayAddress\",\r\n    value: function () {\r\n      return 'https://gateway.elrond.com';\r\n    }\r\n  }, {\r\n    key: \"hwProxy\",\r\n    value: function () {\r\n      var _hwProxy = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {\r\n        var _getErdJs, ProxyProvider, proxy;\r\n\r\n        return _regenerator.default.wrap(function (_context) {\r\n          while (1) {\r\n            switch (_context.prev = _context.next) {\r\n              case 0:\r\n                if (!MoralisErd._proxy) {\r\n                  _context.next = 2;\r\n                  break;\r\n                }\r\n\r\n                return _context.abrupt(\"return\", MoralisErd._proxy);\r\n\r\n              case 2:\r\n                _getErdJs = getErdJs(), ProxyProvider = _getErdJs.ProxyProvider;\r\n                proxy = new ProxyProvider(MoralisErd.gatewayAddress());\r\n                MoralisErd._proxy = proxy;\r\n                return _context.abrupt(\"return\", MoralisErd._proxy);\r\n\r\n              case 6:\r\n              case \"end\":\r\n                return _context.stop();\r\n            }\r\n          }\r\n        }, _callee);\r\n      }));\r\n\r\n      return function () {\r\n        return _hwProxy.apply(this, arguments);\r\n      };\r\n    }()\r\n  }, {\r\n    key: \"hwProvider\",\r\n    value: function () {\r\n      return MoralisErd._hw;\r\n    }\r\n  }, {\r\n    key: \"enable\",\r\n    value: function () {\r\n      var _enable = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2() {\r\n        var _getErdJs2, HWProvider, proxy, hw, success;\r\n\r\n        return _regenerator.default.wrap(function (_context2) {\r\n          while (1) {\r\n            switch (_context2.prev = _context2.next) {\r\n              case 0:\r\n                _getErdJs2 = getErdJs(), HWProvider = _getErdJs2.HWProvider;\r\n                _context2.next = 3;\r\n                return MoralisErd.hwProxy();\r\n\r\n              case 3:\r\n                proxy = _context2.sent;\r\n                hw = new HWProvider(proxy);\r\n                _context2.next = 7;\r\n                return hw.init();\r\n\r\n              case 7:\r\n                success = _context2.sent;\r\n\r\n                if (success) {\r\n                  _context2.next = 10;\r\n                  break;\r\n                }\r\n\r\n                throw new Error(INIT_ERROR);\r\n\r\n              case 10:\r\n                MoralisErd._hw = hw;\r\n                return _context2.abrupt(\"return\", hw);\r\n\r\n              case 12:\r\n              case \"end\":\r\n                return _context2.stop();\r\n            }\r\n          }\r\n        }, _callee2);\r\n      }));\r\n\r\n      return function () {\r\n        return _enable.apply(this, arguments);\r\n      };\r\n    }()\r\n  }, {\r\n    key: \"authenticate\",\r\n    value: function () {\r\n      var _authenticate = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {\r\n        var _context3, _user$get;\r\n\r\n        var hw, address, erdAddress, accounts, data, signature, authData, user;\r\n        return _regenerator.default.wrap(function (_context4) {\r\n          while (1) {\r\n            switch (_context4.prev = _context4.next) {\r\n              case 0:\r\n                _context4.next = 2;\r\n                return MoralisErd.enable();\r\n\r\n              case 2:\r\n                hw = _context4.sent;\r\n                _context4.next = 5;\r\n                return hw.login();\r\n\r\n              case 5:\r\n                address = _context4.sent; // const account = await proxy.getAccount(address);\r\n\r\n                erdAddress = address.toLowerCase();\r\n                accounts = [erdAddress];\r\n                data = MoralisErd.getSigningData();\r\n                _context4.next = 11;\r\n                return MoralisErd.sign(data);\r\n\r\n              case 11:\r\n                signature = _context4.sent;\r\n                authData = {\r\n                  id: erdAddress,\r\n                  signature: signature,\r\n                  data: data\r\n                };\r\n                console.log(authData);\r\n                _context4.next = 16;\r\n                return _ParseUser.default.logInWith('moralisErd', {\r\n                  authData: authData\r\n                });\r\n\r\n              case 16:\r\n                user = _context4.sent;\r\n                _context4.next = 19;\r\n                return user.setACL(new _ParseACL.default(user));\r\n\r\n              case 19:\r\n                if (user) {\r\n                  _context4.next = 21;\r\n                  break;\r\n                }\r\n\r\n                throw new Error('Could not get user');\r\n\r\n              case 21:\r\n                user.set('erdAccounts', uniq((0, _concat.default)(_context3 = []).call(_context3, accounts, (_user$get = user.get('erdAccounts')) !== null && _user$get !== void 0 ? _user$get : [])));\r\n                user.set('erdAddress', erdAddress);\r\n                _context4.next = 25;\r\n                return user.save();\r\n\r\n              case 25:\r\n                return _context4.abrupt(\"return\", user);\r\n\r\n              case 26:\r\n              case \"end\":\r\n                return _context4.stop();\r\n            }\r\n          }\r\n        }, _callee3);\r\n      }));\r\n\r\n      return function () {\r\n        return _authenticate.apply(this, arguments);\r\n      };\r\n    }()\r\n  }, {\r\n    key: \"link\",\r\n    value: function () {\r\n      var _link = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4(account) {\r\n        var _context5, _user$get2;\r\n\r\n        var user, erdAddress, ErdAddress, query, erdAddressRecord, data, signature, authData;\r\n        return _regenerator.default.wrap(function (_context6) {\r\n          while (1) {\r\n            switch (_context6.prev = _context6.next) {\r\n              case 0:\r\n                _context6.next = 2;\r\n                return _ParseUser.default.current();\r\n\r\n              case 2:\r\n                user = _context6.sent;\r\n                erdAddress = account.toLowerCase();\r\n                ErdAddress = _ParseObject.default.extend('_ErdAddress');\r\n                query = new _ParseQuery.default(ErdAddress);\r\n                _context6.next = 8;\r\n                return query.get(erdAddress).catch(function () {\r\n                  return null;\r\n                });\r\n\r\n              case 8:\r\n                erdAddressRecord = _context6.sent;\r\n\r\n                if (erdAddressRecord) {\r\n                  _context6.next = 17;\r\n                  break;\r\n                }\r\n\r\n                data = MoralisErd.getSigningData();\r\n                _context6.next = 13;\r\n                return MoralisErd.sign(data);\r\n\r\n              case 13:\r\n                signature = _context6.sent;\r\n                authData = {\r\n                  id: erdAddress,\r\n                  signature: signature,\r\n                  data: data\r\n                };\r\n                _context6.next = 17;\r\n                return user.linkWith('moralisErd', {\r\n                  authData: authData\r\n                });\r\n\r\n              case 17:\r\n                user.set('erdAccounts', uniq((0, _concat.default)(_context5 = [erdAddress]).call(_context5, (_user$get2 = user.get('erdAccounts')) !== null && _user$get2 !== void 0 ? _user$get2 : [])));\r\n                user.set('erdAddress', erdAddress);\r\n                _context6.next = 21;\r\n                return user.save();\r\n\r\n              case 21:\r\n                return _context6.abrupt(\"return\", user);\r\n\r\n              case 22:\r\n              case \"end\":\r\n                return _context6.stop();\r\n            }\r\n          }\r\n        }, _callee4);\r\n      }));\r\n\r\n      return function () {\r\n        return _link.apply(this, arguments);\r\n      };\r\n    }()\r\n  }, {\r\n    key: \"unlink\",\r\n    value: function () {\r\n      var _unlink = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5(account) {\r\n        var _user$get3;\r\n\r\n        var accountsLower, ErdAddress, query, erdAddressRecord, user, accounts, nextAccounts;\r\n        return _regenerator.default.wrap(function (_context7) {\r\n          while (1) {\r\n            switch (_context7.prev = _context7.next) {\r\n              case 0:\r\n                accountsLower = account.toLowerCase();\r\n                ErdAddress = _ParseObject.default.extend('_EthAddress');\r\n                query = new _ParseQuery.default(ErdAddress);\r\n                _context7.next = 5;\r\n                return query.get(accountsLower);\r\n\r\n              case 5:\r\n                erdAddressRecord = _context7.sent;\r\n                _context7.next = 8;\r\n                return erdAddressRecord.destroy();\r\n\r\n              case 8:\r\n                _context7.next = 10;\r\n                return _ParseUser.default.current();\r\n\r\n              case 10:\r\n                user = _context7.sent;\r\n                accounts = (_user$get3 = user.get('erdAccounts')) !== null && _user$get3 !== void 0 ? _user$get3 : [];\r\n                nextAccounts = (0, _filter.default)(accounts).call(accounts, function (v) {\r\n                  return v !== accountsLower;\r\n                });\r\n                user.set('erdAccounts', nextAccounts);\r\n                user.set('erdAddress', nextAccounts[0]);\r\n                _context7.next = 17;\r\n                return user._unlinkFrom('moralisErd');\r\n\r\n              case 17:\r\n                _context7.next = 19;\r\n                return user.save();\r\n\r\n              case 19:\r\n                return _context7.abrupt(\"return\", user);\r\n\r\n              case 20:\r\n              case \"end\":\r\n                return _context7.stop();\r\n            }\r\n          }\r\n        }, _callee5);\r\n      }));\r\n\r\n      return function () {\r\n        return _unlink.apply(this, arguments);\r\n      };\r\n    }()\r\n  }, {\r\n    key: \"sign\",\r\n    value: function () {\r\n      var _sign = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6(data) {\r\n        return _regenerator.default.wrap(function (_context8) {\r\n          while (1) {\r\n            switch (_context8.prev = _context8.next) {\r\n              case 0:\r\n                return _context8.abrupt(\"return\", data);\r\n\r\n              case 1:\r\n              case \"end\":\r\n                return _context8.stop();\r\n            }\r\n          }\r\n        }, _callee6);\r\n      }));\r\n\r\n      return function () {\r\n        return _sign.apply(this, arguments);\r\n      };\r\n    }()\r\n  }, {\r\n    key: \"getSigningData\",\r\n    value: function () {\r\n      return 'Moralis Authentication';\r\n    }\r\n  }]);\r\n  return MoralisErd;\r\n}();\r\n\r\nfunction uniq(arr) {\r\n  return (0, _filter.default)(arr).call(arr, function (v, i) {\r\n    return (0, _indexOf.default)(arr).call(arr, v) === i;\r\n  });\r\n}\r\n\r\nvar _default = MoralisErd;\r\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}